<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Test de Avance Sostenible - Descubre qu√© patrones est√°n frenando tus metas a√±o tras a√±o">
    <title>Test de Sabotaje de Metas | NeuroWellness Learning</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #F7F4F1;
            color: #4A4D53;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 0.75rem;
        }
        
        .card {
            background: white;
            border-radius: 1.5rem;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .header-gradient {
            background: #14233A;
            color: white;
            padding: 3rem 2rem;
            border-radius: 1.5rem 1.5rem 0 0;
            text-align: center;
        }

        .logo-container {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .logo-container img {
            max-width: 200px;
            height: auto;
        }
        
        .subtitle {
            color: #E9C8C8;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        h1, h2 {
            color: #14233A;
            font-weight: 700;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 1rem;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }
        
        .welcome-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #4A4D53;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #14233A;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #E6E2DE;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #9B6D80;
        }

        .form-group input.error {
            border-color: #dc3545;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .question-card {
            background: white;
            border: 2px solid #E6E2DE;
            border-radius: 1rem;
            padding: 1.25rem 1rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }
        
        .question-card:hover {
            border-color: #9B6D80;
            box-shadow: 0 4px 12px rgba(155, 109, 128, 0.1);
        }
        
        .question-number {
            background: #E9C8C8;
            color: #14233A;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        
        .question-text {
            color: #14233A;
            font-weight: 500;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            font-size: 1.05rem;
            line-height: 1.6;
        }
        
        .scale-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
        }
        
        .scale-option input[type="radio"] {
            display: none;
        }
        
        .scale-option label {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 4rem;
            padding: 0.5rem 0.35rem;
            border: 2px solid #E6E2DE;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            background: white;
            text-align: center;
            line-height: 1.3;
        }
        
        .scale-option input[type="radio"]:checked + label {
            background: #9B6D80;
            border-color: #9B6D80;
            color: white;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(155, 109, 128, 0.3);
        }
        
        .scale-option label:hover {
            border-color: #9B6D80;
            transform: translateY(-2px);
        }
        
        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        
        .btn-primary {
            background: #9B6D80;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #7d5666;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 109, 128, 0.3);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .progress-indicator {
            background: #E6E2DE;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            background: #9B6D80;
            height: 100%;
            transition: width 0.3s;
            width: 0%;
        }
        
        .results {
            display: none;
        }
        
        .results.active {
            display: block;
        }
        
        .pattern-result {
            background: #F7F4F1;
            border-left: 4px solid #9B6D80;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .pattern-name {
            color: #14233A;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .pattern-score {
            font-size: 1.5rem;
            color: #9B6D80;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .pattern-level {
            color: #666;
            font-size: 0.9rem;
            font-style: italic;
        }
        
        .dominant {
            background: #E9C8C8;
            border-left-color: #9B6D80;
            border-left-width: 6px;
        }
        
        .progress-bar {
            background: #E6E2DE;
            height: 8px;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .progress-fill-result {
            background: #9B6D80;
            height: 100%;
            transition: width 0.3s;
        }

        .intro-hibrida {
            background: #FFF9E6;
            border: 2px solid #FFE082;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .intro-hibrida h3 {
            color: #14233A;
            margin-bottom: 1rem;
        }

        .intro-hibrida p {
            line-height: 1.8;
            margin-bottom: 1rem;
        }

        .download-section {
            text-align: center;
            padding: 2rem;
            background: #E9C8C8;
            border-radius: 1rem;
            margin-bottom: 2rem;
        }

        .download-section h3 {
            color: #14233A;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .scale-container {
                grid-template-columns: repeat(5, 1fr);
                gap: 0.25rem;
            }

            .scale-option label {
                font-size: 0.7rem;
                padding: 0.35rem 0.2rem;
                min-height: 3.5rem;
            }

            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-gradient">
                <div class="logo-container">
                    <!-- Aqu√≠ va tu logo -->
                    <img src="https://i.postimg.cc/vHYbBxQz/Logo-Neuro-Wellness-Blanco-(2).png" alt="NeuroWellness Learning">
                    <h1>Test de Sabotaje de Metas</h1>
                </div>
                <p class="subtitle">Descubre qu√© patrones est√°n frenando tus metas a√±o tras a√±o</p>
            </div>
        </div>

        <!-- SECCI√ìN DE INICIO -->
        <div id="start-section">
            <div class="card">
                <h2 style="color: #14233A; margin-bottom: 1rem;">Antes de empezar...</h2>
                <p class="welcome-text">
                    Este test te ayudar√° a identificar los patrones inconscientes que est√°n saboteando tus metas. 
                    Responde con total honestidad para obtener resultados precisos.
                </p>

                <form id="user-info-form">
                    <div class="form-group">
                        <label for="user-name">Tu nombre *</label>
                        <input type="text" id="user-name" name="name" required placeholder="Escribe tu nombre">
                        <span class="error-message" id="name-error">Por favor ingresa tu nombre</span>
                    </div>

                    <div class="form-group">
                        <label for="user-email">Tu email *</label>
                        <input type="email" id="user-email" name="email" required placeholder="tu@email.com">
                        <span class="error-message" id="email-error">Por favor ingresa un email v√°lido</span>
                    </div>

                    <button type="submit" class="btn btn-primary">Comenzar Test</button>
                </form>
            </div>
        </div>

        <!-- SECCI√ìN DE TEST -->
        <div id="test-section" style="display: none;">
            <div class="card">
                <div class="progress-indicator">
                    <div class="progress-fill" id="progress-bar"></div>
                </div>
                <p style="text-align: center; margin-bottom: 1.5rem; color: #666;">
                    <span id="progress-text">0 de 45 preguntas respondidas</span>
                </p>
            </div>

            <div id="questions-container"></div>

            <div class="card">
                <button id="submit-btn" class="btn btn-primary" disabled>Ver Mis Resultados</button>
            </div>
        </div>

        <!-- SECCI√ìN DE RESULTADOS -->
        <div id="results-section" class="results">
            <div class="card">
                <h2 style="color: #14233A; margin-bottom: 1.5rem;">TUS PATRONES DE SABOTAJE</h2>
                
                <div id="intro-hibrida-container"></div>
                
                <div id="results-container"></div>

                <div class="download-section">
                    <h3>¬øQuieres tu gu√≠a completa personalizada?</h3>
                    <p style="margin-bottom: 1.5rem;">Descarga tu an√°lisis detallado con recomendaciones espec√≠ficas para transformar cada patr√≥n</p>
                    <button id="download-pdf-btn" class="btn btn-primary" style="max-width: 400px; margin: 0 auto;">
                        Descargar Mi Gu√≠a Personalizada (PDF)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // CONFIGURACI√ìN Y DATOS
        // ==============================================

        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxbMQQfTBkVMGaGnqcllgQ3gH_UOxqDAU6YfsMHn7Jtr8GX-CCCc7bQ-JuFaAxUha9M/exec';

        let userName = '';
        let userEmail = '';

        // Base de datos de preguntas (AJUSTADAS)
        const preguntas = [
            // PERFECCIONISTA PARALIZADA
            { id: 1, patron: 'perfeccionista', tipo: 'suma', texto: 'Postergo empezar proyectos porque siento que necesito tenerlo todo claramente definido y sin errores antes de dar el primer paso' },
            { id: 2, patron: 'perfeccionista', tipo: 'suma', texto: 'Cuando veo que un proyecto no va a quedar tan bien como lo imagin√©, prefiero dejarlo a entregarlo imperfecto' },
            { id: 3, patron: 'perfeccionista', tipo: 'suma', texto: 'Me paralizo imaginando el juicio negativo de otras personas si mi trabajo no es excelente' },
            { id: 4, patron: 'perfeccionista', tipo: 'resta', texto: 'Empiezo proyectos aunque no est√©n perfectos, porque s√© que puedo mejorar sobre la marcha' },
            { id: 5, patron: 'perfeccionista', tipo: 'resta', texto: 'Me siento c√≥moda con resultados "suficientemente buenos" si cumplen con el prop√≥sito principal' },
            
            // DISPERSA ENTUSIASTA
            { id: 6, patron: 'dispersa', tipo: 'suma', texto: 'Inicio m√∫ltiples metas al mismo tiempo pero termino sin completar ninguna' },
            { id: 7, patron: 'dispersa', tipo: 'suma', texto: 'Me emociono intensamente con ideas nuevas y pierdo inter√©s en las metas que ya hab√≠a empezado' },
            { id: 8, patron: 'dispersa', tipo: 'suma', texto: 'Cada pocas semanas cambio de meta porque encuentro algo que parece m√°s interesante o prometedor' },
            { id: 9, patron: 'dispersa', tipo: 'resta', texto: 'Cuando empiezo algo importante, me comprometo a terminarlo aunque aparezcan nuevas oportunidades tentadoras' },
            { id: 10, patron: 'dispersa', tipo: 'resta', texto: 'Priorizo completar lo que inici√© antes de embarcarme en proyectos nuevos' },
            
            // COMPLACIENTE AGOTADA
            { id: 11, patron: 'complaciente', tipo: 'suma', texto: 'Establezco metas porque siento que "deber√≠a" cumplirlas, no porque realmente me entusiasmen' },
            { id: 12, patron: 'complaciente', tipo: 'suma', texto: 'Mis metas est√°n m√°s conectadas con las expectativas de otras personas (familia, pareja, sociedad) que con mis propios deseos' },
            { id: 13, patron: 'complaciente', tipo: 'suma', texto: 'Siento resentimiento o cansancio cuando trabajo en mis metas, como si fueran una obligaci√≥n' },
            { id: 14, patron: 'complaciente', tipo: 'resta', texto: 'Cuando me planteo una meta, siento emoci√≥n genuina y conexi√≥n profunda con lo que quiero lograr' },
            { id: 15, patron: 'complaciente', tipo: 'resta', texto: 'Me siento energizada y motivada cuando trabajo en mis metas porque conectan con quien realmente soy' },
            
            // SABOTEADORA INVISIBLE
            { id: 16, patron: 'saboteadora', tipo: 'suma', texto: 'Cuando estoy cerca de lograr algo importante, de repente hago cosas que sabotean mi progreso' },
            { id: 17, patron: 'saboteadora', tipo: 'suma', texto: 'En el fondo siento que "no merezco" o "no soy la persona" para lograr ciertas cosas' },
            { id: 18, patron: 'saboteadora', tipo: 'suma', texto: 'Me siento inc√≥moda o ansiosa cuando las cosas van demasiado bien, como si algo malo fuera a pasar' },
            { id: 19, patron: 'saboteadora', tipo: 'resta', texto: 'Creo genuinamente que merezco alcanzar las metas que me propongo' },
            { id: 20, patron: 'saboteadora', tipo: 'resta', texto: 'Me siento c√≥moda celebrando mis logros sin minimizarlos o sentir que "fue suerte"' },
            
            // DEPENDIENTE DE MOTIVACI√ìN
            { id: 21, patron: 'dependiente', tipo: 'suma', texto: 'Solo trabajo en mis metas cuando me siento motivada o inspirada' },
            { id: 22, patron: 'dependiente', tipo: 'suma', texto: 'Cuando pierdo el entusiasmo inicial por algo, dejo de hacerlo aunque s√© que es importante' },
            { id: 23, patron: 'dependiente', tipo: 'suma', texto: 'Creo que necesito sentir motivaci√≥n antes de poder actuar en mis metas' },
            { id: 24, patron: 'dependiente', tipo: 'resta', texto: 'Act√∫o en mis metas incluso cuando no tengo ganas, porque conf√≠o en mis sistemas y rutinas' },
            { id: 25, patron: 'dependiente', tipo: 'resta', texto: 'Entiendo que la motivaci√≥n viene DESPU√âS de empezar a actuar, no antes' },
            
            // CASTIGADORA INTERNA
            { id: 26, patron: 'castigadora', tipo: 'suma', texto: 'Mi di√°logo interno es muy duro y cr√≠tico conmigo cuando fallo o cometo errores' },
            { id: 27, patron: 'castigadora', tipo: 'suma', texto: 'Si tengo un desliz o fallo un d√≠a, siento que "ya arruin√© todo" y abandono completamente la meta' },
            { id: 28, patron: 'castigadora', tipo: 'suma', texto: 'Me enfoco m√°s en castigarme por lo que hice mal que en celebrar lo que hice bien' },
            { id: 29, patron: 'castigadora', tipo: 'resta', texto: 'Cuando cometo un error, lo veo como una oportunidad de aprendizaje sin juzgarme duramente' },
            { id: 30, patron: 'castigadora', tipo: 'resta', texto: 'Me hablo a m√≠ misma con la misma compasi√≥n con la que le hablar√≠a a una amiga que est√° pasando por algo dif√≠cil' },
            
            // SO√ëADORA SIN RA√çCES
            { id: 31, patron: 'sonadora', tipo: 'suma', texto: 'Tengo metas muy ambiciosas pero no tengo claridad de los pasos peque√±os y concretos para llegar all√≠' },
            { id: 32, patron: 'sonadora', tipo: 'suma', texto: 'Mis metas se sienten desconectadas de quien soy ahora o de las fortalezas que ya tengo' },
            { id: 33, patron: 'sonadora', tipo: 'suma', texto: 'Espero un cambio radical o una transformaci√≥n m√°gica en lugar de construir progreso gradual' },
            { id: 34, patron: 'sonadora', tipo: 'resta', texto: 'Mis metas est√°n construidas sobre mis fortalezas actuales y mi historia personal' },
            { id: 35, patron: 'sonadora', tipo: 'resta', texto: 'Tengo claridad de los micro-pasos espec√≠ficos que me llevar√°n desde donde estoy ahora hasta mi meta' },
            
            // ADICTA A LO URGENTE
            { id: 36, patron: 'adicta', tipo: 'suma', texto: 'Solo logro ser productiva cuando hay presi√≥n, crisis o una fecha l√≠mite inminente' },
            { id: 37, patron: 'adicta', tipo: 'suma', texto: 'Dejo que las urgencias del d√≠a a d√≠a desplacen constantemente el trabajo en mis metas importantes' },
            { id: 38, patron: 'adicta', tipo: 'suma', texto: 'Vivo en modo reactivo (apagando incendios) en lugar de proactivo (construyendo hacia mis metas)' },
            { id: 39, patron: 'adicta', tipo: 'resta', texto: 'Dedico tiempo consistente a lo importante aunque no sea urgente' },
            { id: 40, patron: 'adicta', tipo: 'resta', texto: 'Tengo sistemas que protegen el tiempo para mis metas de las distracciones y urgencias del d√≠a' },
            
            // V√çCTIMA DE CIRCUNSTANCIAS
            { id: 41, patron: 'victima', tipo: 'suma', texto: 'Cuando no avanzo en mis metas, tiendo a pensar que es por factores externos que no controlo (tiempo, dinero, otras personas)' },
            { id: 42, patron: 'victima', tipo: 'suma', texto: 'Cuando enfrento obst√°culos, mi primera reacci√≥n es encontrar razones de por qu√© no es posible, en lugar de buscar soluciones' },
            { id: 43, patron: 'victima', tipo: 'suma', texto: 'Me repito a m√≠ misma "as√≠ soy yo" o "no puedo cambiar" cuando enfrento dificultades' },
            { id: 44, patron: 'victima', tipo: 'resta', texto: 'Asumo responsabilidad por crear soluciones incluso cuando las circunstancias no son ideales' },
            { id: 45, patron: 'victima', tipo: 'resta', texto: 'Ante obst√°culos, mi mentalidad es "¬øc√≥mo puedo hacer esto funcionar?" en lugar de "esto no se puede"' }
        ];

        const patronesInfo = {
            perfeccionista: { nombre: 'La Perfeccionista Paralizada', emoji: 'üéØ' },
            dispersa: { nombre: 'La Dispersa Entusiasta', emoji: '‚ú®' },
            complaciente: { nombre: 'La Complaciente Agotada', emoji: 'üòî' },
            saboteadora: { nombre: 'La Saboteadora Invisible', emoji: 'üé≠' },
            dependiente: { nombre: 'La Dependiente de Motivaci√≥n', emoji: '‚ö°' },
            castigadora: { nombre: 'La Castigadora Interna', emoji: 'üíî' },
            sonadora: { nombre: 'La So√±adora Sin Ra√≠ces', emoji: '‚òÅÔ∏è' },
            adicta: { nombre: 'La Adicta a lo Urgente', emoji: 'üî•' },
            victima: { nombre: 'La V√≠ctima de Circunstancias', emoji: '‚õìÔ∏è' }
        };

        // Mezclar preguntas
        const preguntasMezcladas = [...preguntas].sort(() => Math.random() - 0.5);
        
        // Respuestas del usuario
        const respuestas = {};

        // ==============================================
        // FORMULARIO INICIAL
        // ==============================================

        document.getElementById('user-info-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nameInput = document.getElementById('user-name');
            const emailInput = document.getElementById('user-email');
            
            let isValid = true;
            
            // Validar nombre
            if (!nameInput.value.trim()) {
                nameInput.classList.add('error');
                document.getElementById('name-error').style.display = 'block';
                isValid = false;
            } else {
                nameInput.classList.remove('error');
                document.getElementById('name-error').style.display = 'none';
            }
            
            // Validar email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailInput.value.trim())) {
                emailInput.classList.add('error');
                document.getElementById('email-error').style.display = 'block';
                isValid = false;
            } else {
                emailInput.classList.remove('error');
                document.getElementById('email-error').style.display = 'none';
            }
            
            if (isValid) {
                userName = nameInput.value.trim();
                userEmail = emailInput.value.trim();
                
                document.getElementById('start-section').style.display = 'none';
                document.getElementById('test-section').style.display = 'block';
                window.scrollTo(0, 0);
            }
        });

        // ==============================================
        // RENDERIZAR PREGUNTAS
        // ==============================================

        function renderPreguntas() {
            const container = document.getElementById('questions-container');
            
            preguntasMezcladas.forEach((pregunta, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-text">
                        <div class="question-number">${index + 1}</div>
                        <div style="flex: 1;">${pregunta.texto}</div>
                    </div>
                    <div class="scale-container">
                        <div class="scale-option">
                            <input type="radio" id="q${pregunta.id}_1" name="q${pregunta.id}" value="0" required>
                            <label for="q${pregunta.id}_1">Nunca</label>
                        </div>
                        <div class="scale-option">
                            <input type="radio" id="q${pregunta.id}_2" name="q${pregunta.id}" value="1" required>
                            <label for="q${pregunta.id}_2">Casi nunca</label>
                        </div>
                        <div class="scale-option">
                            <input type="radio" id="q${pregunta.id}_3" name="q${pregunta.id}" value="2" required>
                            <label for="q${pregunta.id}_3">A veces</label>
                        </div>
                        <div class="scale-option">
                            <input type="radio" id="q${pregunta.id}_4" name="q${pregunta.id}" value="3" required>
                            <label for="q${pregunta.id}_4">Frecuentemente</label>
                        </div>
                        <div class="scale-option">
                            <input type="radio" id="q${pregunta.id}_5" name="q${pregunta.id}" value="4" required>
                            <label for="q${pregunta.id}_5">Siempre</label>
                        </div>
                    </div>
                `;
                container.appendChild(questionCard);
            });

            // Escuchar cambios en las respuestas
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.addEventListener('change', (e) => {
                    const questionId = parseInt(e.target.name.replace('q', ''));
                    respuestas[questionId] = parseInt(e.target.value);
                    updateProgress();
                    checkAllAnswered();
                });
            });
        }

        // ==============================================
        // PROGRESO
        // ==============================================

        function updateProgress() {
            const total = 45;
            const answered = Object.keys(respuestas).length;
            const percentage = (answered / total) * 100;
            
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = `${answered} de ${total} preguntas respondidas`;
        }

        function checkAllAnswered() {
            const allAnswered = Object.keys(respuestas).length === 45;
            document.getElementById('submit-btn').disabled = !allAnswered;
        }

        // ==============================================
        // CALCULAR RESULTADOS
        // ==============================================

        function calcularResultados() {
            const puntosPorPatron = {
                perfeccionista: 0,
                dispersa: 0,
                complaciente: 0,
                saboteadora: 0,
                dependiente: 0,
                castigadora: 0,
                sonadora: 0,
                adicta: 0,
                victima: 0
            };

            preguntas.forEach(pregunta => {
                const respuesta = respuestas[pregunta.id];
                let puntos;
                
                if (pregunta.tipo === 'suma') {
                    puntos = respuesta;
                } else {
                    puntos = 4 - respuesta;
                }
                
                puntosPorPatron[pregunta.patron] += puntos;
            });

            return puntosPorPatron;
        }

        // ==============================================
        // SISTEMA DE ENSAMBLAJE DE INTROS H√çBRIDAS
        // ==============================================

        const DESCRIPCIONES_CORTAS = {
            perfeccionista: "postergas empezar porque necesitas que todo est√© perfecto antes de iniciar",
            dispersa: "te emocionas intensamente con ideas nuevas pero pierdes inter√©s cuando pasa la novedad",
            complaciente: "estableces metas porque sientes que 'deber√≠as' cumplirlas, m√°s que por deseo aut√©ntico",
            saboteadora: "cuando est√°s cerca de lograr algo importante, inconscientemente haces cosas que sabotean tu progreso",
            dependiente: "solo act√∫as cuando te sientes motivada o inspirada",
            castigadora: "tu di√°logo interno es muy duro y cr√≠tico contigo cuando fallas o cometes errores",
            sonadora: "tienes metas ambiciosas pero sin claridad de los pasos peque√±os y concretos para llegar ah√≠",
            adicta: "eres productiva √∫nicamente bajo presi√≥n o crisis inminente",
            victima: "sientes que las circunstancias externas (tiempo, dinero, otras personas) son las que te impiden avanzar"
        };

        const DINAMICAS = {
            "adicta-dependiente-dispersa": "ciclo de r√°fagas intensas seguidas de colapsos",
            "castigadora-perfeccionista": "ciclo vicioso de par√°lisis seguida de auto-castigo brutal",
            "perfeccionista-saboteadora": "par√°lisis por miedo al juicio que termina en auto-sabotaje",
            "complaciente-victima": "resentimiento profundo y externalizaci√≥n de responsabilidad",
            "dependiente-dispersa": "inicias m√∫ltiples cosas cuando hay emoci√≥n, abandonas cuando baja la energ√≠a",
            "adicta-dispersa": "ciclo de r√°fagas intensas seguidas de colapsos"
        };

        const CONSECUENCIAS = {
            "adicta-dependiente-dispersa": "Inicias m√∫ltiples proyectos en momentos de alta energ√≠a (novedad + urgencia), pero los abandonas cuando desaparece la presi√≥n o el entusiasmo inicial. Vives en extremos: todo o nada. Este ciclo te genera frustraci√≥n acumulada y una sensaci√≥n constante de no completar lo que empiezas.",
            "castigadora-perfeccionista": "Te paralizas esperando perfecci√≥n, y cuando intentas y fallas, te destruyes emocionalmente. El castigo interno refuerza tu miedo a intentar, creando un ciclo de inacci√≥n y auto-maltrato.",
            "perfeccionista-saboteadora": "Cuando est√°s cerca de lanzar algo, tu perfeccionismo se intensifica como sabotaje inconsciente. Siempre encuentras 'una cosa m√°s que arreglar' porque en el fondo tienes miedo de ser juzgada.",
            "complaciente-victima": "Cumples expectativas de otras personas mientras sientes que 'no puedes' perseguir lo tuyo por circunstancias. El resentimiento se acumula porque vives la vida de otras sin agencia en la tuya.",
            "dependiente-dispersa": "Te emocionas con ideas nuevas e inicias con energ√≠a explosiva, pero cuando baja la motivaci√≥n (que siempre baja), abandonas. Acumulas proyectos sin terminar esperando que 'vuelvan las ganas'.",
            "adicta-dispersa": "Inicias m√∫ltiples proyectos en momentos de alta energ√≠a y urgencia, pero los abandonas cuando desaparece la presi√≥n. Vives en extremos productivos seguidos de colapsos."
        };

        function generarIntroHibrida(patronesDominantes) {
            if (patronesDominantes.length === 1) {
                return null; // No hay intro h√≠brida para un solo patr√≥n
            }

            const numPatrones = patronesDominantes.length;
            const descripciones = patronesDominantes.map(p => DESCRIPCIONES_CORTAS[p]);
            
            const dynamicKey = patronesDominantes.sort().join('-');
            let dinamica = DINAMICAS[dynamicKey] || "un sistema complejo de sabotaje";
            let consecuencia = CONSECUENCIAS[dynamicKey];
            
            if (!consecuencia) {
                consecuencia = "Esta combinaci√≥n crea un bloqueo complejo donde cada patr√≥n refuerza al otro, dificultando tu avance en las metas que te importan.";
            }
            
            return `
                <div class="intro-hibrida">
                    <h3>Tu Sistema de Sabotaje Personalizado</h3>
                    <p><strong>Tus ${numPatrones} patrones dominantes crean ${dinamica}:</strong></p>
                    <p>${descripciones.join(', ')}.</p>
                    <p><strong>Resultado:</strong> ${consecuencia}</p>
                </div>
            `;
        }

        // ==============================================
        // MOSTRAR RESULTADOS
        // ==============================================

        function mostrarResultados() {
            const resultados = calcularResultados();
            
            // Ordenar patrones por puntuaci√≥n
            const patronesOrdenados = Object.entries(resultados)
                .map(([patron, puntos]) => ({
                    patron,
                    puntos,
                    porcentaje: (puntos / 20) * 100,
                    info: patronesInfo[patron]
                }))
                .sort((a, b) => b.puntos - a.puntos);

            // Identificar dominantes (‚â•10 puntos)
            const dominantes = patronesOrdenados.filter(p => p.puntos >= 10);

            // Generar intro h√≠brida si hay m√∫ltiples dominantes
            const introHibridaContainer = document.getElementById('intro-hibrida-container');
            if (dominantes.length > 1) {
                const patronesDominantesNombres = dominantes.map(d => d.patron);
                const introHTML = generarIntroHibrida(patronesDominantesNombres);
                if (introHTML) {
                    introHibridaContainer.innerHTML = introHTML;
                }
            }

            const container = document.getElementById('results-container');
            container.innerHTML = '';

            // Mostrar solo los patrones dominantes
            if (dominantes.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; background: #FFF9E6; border-radius: 1rem;">
                        <p style="font-size: 1.1rem; line-height: 1.8;">
                            Tus resultados muestran que no tienes patrones dominantes marcados (todos est√°n por debajo de 10 puntos). 
                            Esto podr√≠a indicar que tus dificultades para cumplir metas tienen un origen diferente o que respondiste 
                            con menos intensidad de la que experimentas. Te recomendamos reflexionar m√°s profundamente sobre tus patrones 
                            o repetir el test siendo m√°s honesta con tus respuestas.
                        </p>
                    </div>
                `;
            } else {
                dominantes.forEach((item, index) => {
                    const card = document.createElement('div');
                    card.className = 'pattern-result dominant';
                    
                    let nivel;
                    if (item.puntos >= 15) nivel = 'MUY ALTO - Este patr√≥n te est√° limitando severamente';
                    else if (item.puntos >= 10) nivel = 'ALTO - Este patr√≥n es significativo en tu vida';
                    
                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <div class="pattern-name">${item.info.emoji} ${item.info.nombre}</div>
                                <div class="pattern-score">${item.puntos}/20 puntos (${item.porcentaje.toFixed(0)}%)</div>
                                <div class="pattern-level">${nivel}</div>
                            </div>
                            <div style="background: #9B6D80; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: bold; font-size: 0.9rem;">
                                PATR√ìN DOMINANTE #${index + 1}
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill-result" style="width: ${item.porcentaje}%"></div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }

            // Enviar a Google Sheets
            enviarAGoogleSheets(resultados, dominantes);

            // Mostrar secci√≥n de resultados
            document.getElementById('test-section').style.display = 'none';
            document.getElementById('results-section').classList.add('active');
            window.scrollTo(0, 0);
        }

        // ==============================================
        // ENVIAR A GOOGLE SHEETS
        // ==============================================

        function enviarAGoogleSheets(resultados, dominantes) {
            const datos = {
                timestamp: new Date().toISOString(),
                nombre: userName,
                email: userEmail,
                perfeccionista: resultados.perfeccionista,
                dispersa: resultados.dispersa,
                complaciente: resultados.complaciente,
                saboteadora: resultados.saboteadora,
                dependiente: resultados.dependiente,
                castigadora: resultados.castigadora,
                sonadora: resultados.sonadora,
                adicta: resultados.adicta,
                victima: resultados.victima,
                patronesDominantes: dominantes.map(d => d.info.nombre).join(', '),
                respuestas: JSON.stringify(respuestas)
            };
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(datos)
            })
            .then(() => {
                console.log('‚úÖ Resultados guardados en Google Drive');
            })
            .catch((error) => {
                console.error('‚ùå Error al guardar:', error);
            });
        }

        // ==============================================
        // GENERAR PDF
        // ==============================================

        document.getElementById('download-pdf-btn').addEventListener('click', async function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Nota: Aqu√≠ ir√≠a la l√≥gica completa de generaci√≥n de PDF
            // Por ahora, un PDF simple
            
            doc.setFontSize(20);
            doc.text('Tu Gu√≠a de Transformaci√≥n', 20, 20);
            
            doc.setFontSize(12);
            doc.text(`Nombre: ${userName}`, 20, 40);
            doc.text(`Email: ${userEmail}`, 20, 50);
            
            doc.text('Tus patrones dominantes y c√≥mo transformarlos', 20, 70);
            doc.text('(Contenido completo se agregar√° aqu√≠)', 20, 80);
            
            doc.save(`Guia-Transformacion-${userName.replace(/\s+/g, '-')}.pdf`);
        });

        // ==============================================
        // EVENT LISTENERS
        // ==============================================

        document.getElementById('submit-btn').addEventListener('click', mostrarResultados);

        // Inicializar
        renderPreguntas();
    </script>
</body>
</html>
